name: Upload Images

on:
  push:
    paths:
      - 'images.csv'

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install requirements
        run: pip install requests

      - name: Run upload script
        run: |
          import csv, os, requests
          os.makedirs('images', exist_ok=True)
          with open('images.csv', newline='') as f:
              reader = csv.reader(f)
              for row in reader:
                  url = row[0].strip()
                  if not url: continue
                  filename = os.path.join('images', url.split('/')[-1].split('?')[0])
                  try:
                      r = requests.get(url, timeout=15)
                      with open(filename, 'wb') as img:
                          img.write(r.content)
                  except Exception as e:
                      print(f"Failed to download {url}: {e}")
          print("âœ… All done.")
        shell: python